'use strict';let toc=document.getElementById('toc'),song=document.getElementById('song'),back=document.getElementById('back'),overlay=document.getElementById('overlay'),modal=document.getElementById('modal'),modalClose=modal.getElementsByClassName('modal__close')[0],refresh=document.getElementById('refresh'),navbar=document.getElementById('navbar'),modalBody=document.getElementById('modalBody'),songArray=[];initializeSongs(),populateNav(),document.addEventListener('keyup',a=>{27==a.which&&modalClose.click()}),overlay.addEventListener('click',()=>{showModal(!1)}),modalClose.addEventListener('click',()=>{showModal(!1)}),modalBody.addEventListener('click',a=>{if(a.target.classList.contains('modal__item')){let a=modal.querySelector('.modal__num').innerText;showSong(a)}},!1),back.addEventListener('click',()=>{toc.removeAttribute('hidden'),song.setAttribute('hidden',''),back.setAttribute('disabled','')}),refresh.addEventListener('click',()=>{localStorage.removeItem('songs'),location.reload(!0)});function populateNav(){navbar.addEventListener('click',a=>{if(a.target.classList.contains('content__nav-span')){let b=a.target.innerText;b=b.replace(/-/g,' '),b=b.split(/\s+/),showRecords(b)}},!1)}function showRecords(a){var b=Number.parseInt;for(showModal(!0);modalBody.firstChild;)modalBody.removeChild(modalBody.firstChild);if(console.log(a),'All'===a[0]){let a=songArray.length;for(let b=0;b<a;b++){let a=document.createElement('div'),c=document.createElement('span');c.classList.add('modal__num'),c.innerText=b+1,a.insertAdjacentElement('beforeend',c),a.classList.add('modal__item'),a.innerText=songArray[b].title,modalBody.insertAdjacentElement('beforeend',a),a.insertAdjacentElement('beforeend',c)}}else if(Number.isInteger(b(a[0])))for(let c=b(a[0])-1;c<b(a[1]);c++){let a=document.createElement('div'),b=document.createElement('span');b.classList.add('modal__num'),b.innerText=c+1,a.insertAdjacentElement('beforeend',b),a.classList.add('modal__item'),a.innerText=songArray[c].title,modalBody.insertAdjacentElement('beforeend',a),a.insertAdjacentElement('beforeend',b)}else{let b=Object.keys(songArray).length,c=[];for(let d=0;d<b;d++)songArray[d].title.charAt(0)===a[0]&&c.push([songArray[d].title,d]);c.sort(function(c,a){return c[0].toUpperCase().localeCompare(a[0].toUpperCase())});for(let a=0;a<c.length;a++){let b=document.createElement('div'),d=document.createElement('span');d.classList.add('modal__num'),d.innerText=c[a][1]+1,b.classList.add('modal__item'),b.innerText=c[a][0],modalBody.insertAdjacentElement('beforeend',b),b.insertAdjacentElement('beforeend',d)}}}function showModal(a){a?(modal.classList.add('modal--active'),overlay.classList.add('overlay--active')):(modal.classList.remove('modal--active'),overlay.classList.remove('overlay--active'))}function showSong(a){let b=songArray[a],c=[],d=b.number,e=b.title,f=b.verse,g=b.chorus,h=b.author;song.innerHTML='',c.push(d,e,f,g,h);let j=c.length,k=document.createElement('div');k.classList.add('songHeader');for(let b=0;b<j;b++)switch(b){case 0:if(c[b]){let a=document.createElement('div');a.classList.add('songNum'),a.innerText=c[b],k.insertAdjacentElement('beforeend',a)}break;case 1:if(c[b]){let a=document.createElement('div');a.classList.add('songTitle'),a.innerText=c[b],k.insertAdjacentElement('afterbegin',a),song.insertAdjacentElement('beforeend',k)}break;case 2:if(c[b]){let a=c[b].length+1;for(let d,e=0;e<a;e++)switch(d=document.createElement('div'),e){case 0:d.classList+='verse',d.innerText=cleanupString(c[b][e]),song.insertAdjacentElement('beforeend',d);break;case 1:0<c[3].length&&(d.classList+='chorus',d.innerText=cleanupString(c[3]),song.insertAdjacentElement('beforeend',d));break;default:d.classList+='verse',d.innerText=cleanupString(c[b][e-1]),song.insertAdjacentElement('beforeend',d);}}break;case 4:if(c[b]){let a=document.createElement('div');a.classList+='author',a.innerText=c[b],song.insertAdjacentElement('beforeend',a)}}return toc.setAttribute('hidden',''),song.removeAttribute('hidden'),back.removeAttribute('disabled'),modalClose.click(),!1}function cleanupString(a){let b=a.replace(/\*/g,'').replace(/\s{2,}/g,'\n').trim();return b}async function initializeSongs(){function a(a){let b=document.createElement('span');return b.classList.add('content__nav-span'),b.innerText=a,b}function b(a){let b=document.createElement('div');b.classList.add('content__nav-item');for(let c of a)b.appendChild(c);navbar.insertAdjacentElement('beforeend',b)}function c(){return new Promise(async a=>{let b=await fetch('js/songs.json');if(b.ok)console.info('Song database found!'),a(b.json());else throw`File "${'js/songs.json'}" not found on server!`}).catch(a=>{console.error(a)})}function d(a){return new Promise(b=>{console.info('Loading song data...'),localStorage.setItem('songs',JSON.stringify(a)),b()})}localStorage.hasOwnProperty('songs')||(console.info('Searching for list of songs...'),await async function(){let a=await c();return await d(a),new Promise(a=>{a()}).catch(a=>{console.error(a)})}()),songArray=await function(){return new Promise(a=>{console.info('Loading songs into memory...'),a(JSON.parse(localStorage.getItem('songs')))})}(),await function(){return new Promise(c=>{let d=[],e=songArray.slice(),f=[];for(let a=0;26>a;a++)d.push(String.fromCharCode(65+a));f.push(a('All')),b(f),f=[];for(let b=0;b<d.length;b++)songArray.some(a=>a.title.charAt(0)===d[b])&&f.push(a(d[b]));b(f),f=[];for(let b=0,d=Math.floor(songArray.length/100),g=null;b<=d;b++)g=100<e.length?99:e.length-1,f.push(a(`${e[0].number} - ${e[g].number}`)),e.splice(0,g+1);b(f),f=[],c()})}()}

